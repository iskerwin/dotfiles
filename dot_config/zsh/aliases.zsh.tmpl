##############################
# File Navigation            #
##############################

# Directory Navigation
alias cd='z'
alias home='cd ~'
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias icloud='cd {{ .icloud }}'

# Directory Listing (using eza/exa)
if command -v eza >/dev/null 2>&1; then
    alias ls='eza --group-directories-first --icons --git --time-style=long-iso'
else
    alias ls='ls --color=auto'
fi

alias la='ls -a -l'                             # List all files including hidden
alias ld='la -D'                                # List only dirs
alias lf='la -f'                                # List only files
alias ll='ls -l'                                # Long format
alias lr='ll -T --level=2'                      # Long format, recursive as tree
alias lx='ll -sextension'                       # Sort by extension
alias lk='ll -ssize'                            # Sort by size
alias lt='ll -smodified'                        # Sort by modification time
alias lc='ll -schanged'                         # Sort by change time
alias l.='ls -d .*'                             # List only dotfiles
alias l='ll -a --git-ignore'                    # Long format, all files
alias tree='eza --tree --level=2 --group-directories-first --icons'

# Safe Operations
alias rm='rm -i'   # Confirm before deleting
alias cp='cp -i'   # Confirm before copying
alias mv='mv -i'   # Confirm before moving

install_missing() {
    local package=$1
    if (( ${+commands[brew]} )); then
        echo "Installing $package..."
        brew install $package
    else
        echo "Error: Homebrew not found. Please install Homebrew first."
        echo "Visit https://brew.sh for installation instructions."
    fi
}

# Clean .DS_Store files (requires fd command)
if (( ${+commands[fd]} )); then
    alias clean-ds='fd -H -I -t f ".DS_Store" --exec rm -f {}'  # Clean all .DS_Store files recursively
else
    alias clean-ds='echo "Installing fd..." && install_missing fd'
fi

##############################
# System Operations          #
##############################

# Homebrew Package Management
alias update='brew update && brew upgrade && brew cleanup && brew doctor'      # Update Homebrew/Cask
alias cleanup='brew cleanup'                                                   # Clean old versions
alias install='brew install'                                                   # Install package
alias uninstall='brew uninstall'                                               # Remove package
alias doctor='echo "\nDoctor? Doctor who?\n" && brew doctor'                   # Check system
alias update-cask='brew cu -a -f -v --no-brew-update -y && brew cleanup'       # Update all casks with non-official.
# alias update-cask='brew update && brew upgrade --cask && brew cleanup'         # Update all casks with homebrew
alias brewbackup='brew bundle dump --describe --force --file={{ .brewfile }}'  # Backup brew packages
alias brewrestore='brew bundle --file={{ .brewfile }}'                         # Restore brew packages

# System Information
alias ip='ifconfig en0 | grep inet'                 # Show local IP
alias nt='nexttrace'                                # Visual traceroute tool                        
alias ipw='function _ipw(){ curl ip.im/$1; };_ipw'  # IP where
alias internal='unproxy && curl ipv4.im/info'       # Internal IP
alias external='proxy && curl ipv4.im/info'         # External IP
alias speed='networkQuality'                        # Network speed test
alias netports="networksetup -listallhardwareports" # List all network hardware ports
alias portcheck="nc -zv"                            # Quick port check
alias digcheck="dig +nocmd +noall +answer"          # Detailed DNS query
alias testinternet="curl -I"
alias weather='curl wttr.in/Guangzhou'              # Show weather
alias lsdev='ls /dev/cu.*'                          # List serial devices
alias proxy='export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890'
alias unproxy='unset https_proxy http_proxy all_proxy'

##############################
# SSH Management             #
##############################

alias ssh='ct screen ssh'                           # SSH with screen support
alias sshls='grep "^Host " ~/.ssh/config'           # List SSH hosts
alias sshals='ps aux | grep ssh-agent'              # List SSH-agent process
alias sshalk='ssh-add --apple-load-keychain'        # Load key with keychain
alias sshags='eval "$(ssh-agent -s)"'               # Start SSH-agent

##############################
# Screen Management          #
##############################
alias screen='ct screen'
alias sn='screen -S'                              # Create/attach screen session
alias sl='screen -ls'                             # List screen sessions
alias sr='screen -r'                              # Reattach to screen
alias sm='screen -DR main'                        # Main screen session
alias sk='killall screen'                         # Kill all screens
alias sd='screen -d'                              # Detach screen
alias snw='screen -X screen'                      # New window in current session
alias snd='screen -dm'                            # Create detached session
alias console='screen -fn /dev/cu.BTConsole 9600' # # Connect to Bluetooth console (9600 baud rate)

# Run command in new screen window
srun() {
    screen -dm bash -c "$*"
}

##############################
# Miscellaneous              #
##############################

alias f='fzf'
alias c='clear'
alias g='git'
alias lg='lazygit'                                # lazygit
alias rz='source ~/.zshrc'                        # Reload zsh config
alias af='source ~/.config/fzf/fzf-aliases.zsh'   # Aliases tool
alias path='echo; tr ":" "\n" <<< "$PATH"; echo;' # Pretty print PATH

##############################
# Chezmoi Aliases            #
##############################

# Core Commands (最常用的核心命令)
alias cz='chezmoi'                      # Base command with shorter alias
alias czcd='chezmoi cd'                 # Navigate to source directory
alias czs='chezmoi status'              # Show status
alias cza='chezmoi add -v'              # Add files
alias cze='chezmoi edit'                # Edit files
alias czd='chezmoi diff -v'             # Show differences
alias czp='chezmoi apply -v'            # Apply changes

# Extended Operations (扩展操作)
alias czr='chezmoi re-add -v'           # Re-add files
alias czf='chezmoi apply --force'       # Force apply
alias czea='chezmoi edit --apply'       # Edit and apply
alias czup='chezmoi update -v'          # Update from source
alias czug='chezmoi upgrade'            # Upgrade chezmoi

# Information & Debug (信息和调试)
alias czls='chezmoi managed'            # List managed files
alias czda='chezmoi data'               # Show template data
alias czdc='chezmoi doctor'             # Check installation
alias czv='chezmoi verify'              # Verify configuration

# Git Integration (Git 集成)
# Using czg prefix for consistency with git operations
alias czg='chezmoi git --'              # Git operations
alias czga='czg add'                    # Stage changes
alias czgc='czg commit -m'              # Commit changes
alias czgp='czg push'                   # Push changes
alias czgl='czg pull'                   # Pull changes
alias czgs='czg status'                 # Git status

# Common Workflows
alias czap='chezmoi add -v && chezmoi apply -v'            # Add and apply
alias czep='chezmoi edit --apply && chezmoi apply -v'      # Edit and apply
alias czsync='czgl && czp && czgp'                         # Full sync workflow